
**Студент:**  Заколпина Анастасия Николаевна  
**Группа:**  М01-504а  
**Преподаватель:**  Дьяченко Роман Александрович
**Дата выполнения:**  9 ноября 2025 г.

**Цель работы:**  
Освоить методы изменения и анализа цветовой информации в облаках точек с использованием программного обеспечения CloudCompare, а также приобрести навыки визуализации и интерпретации результатов цветового кодирования для решения задач обработки трёхмерных данных.

------
##### Шаг 1: Импорт облака точек
1. Запущено приложение **CloudCompare**.
2. Выполнен импорт тестового облака точек с помощью:  
    `File → Open → [файл: valve_0136_lidar_classes.ply]`.
3. В панели _Properties подтверждено наличие блока **Colors**, что свидетельствует о наличии цветовой информации (RGB) в исходных данных.
(./lab2/task1/Pasted image 20251209112551.png)
**Рис. 1 — Исходное облако точек с цветовой информацией**

![[Pasted image 20251209112948.png]]
**Рис. 2 —  Панель Properties**

##### Шаг 2: Применение цветовых операций
###### 2.1 `Edit → Colors → Set Color`
- Выбрана команда `Edit → Colors → Set Color`.
- Установлен единый синий цвет: **R=0, G=0, B=255**.
- Все точки облака окрасились в однородный синий.
- Это полезно для унификации визуального стиля или выделения объекта на фоне других.
![[Pasted image 20251209113118.png]]
 **Рис. 2 — Облако точек после применения Set Color (единый синий цвет)**   
###### 2.2 `Edit → Colors → Height Ramp`
- Применена градация по высоте: `Edit → Colors → Height Ramp`.
- Цвета распределены по оси **Z**:
    - Минимум (Z_min) → синий
    - Максимум (Z_max) → красный
- Для точной настройки использованы:  
    `Edit → Scalar fields → Compute → Height above` → затем `Set SF as active` → `Height Ramp (custom)`.
- Здание визуально «слоисто»: основание — синее, верхние этажи — красные/оранжевые.
![[Pasted image 20251209113236.png]]
**Рис. 3 — Облако точек после применения Height Ramp (градиент по высоте)**  
###### 2.3 `Edit → Colors → Convert to Grey Scale`
- Выполнено преобразование в оттенки серого:  
    `Edit → Colors → Convert to Grey Scale`.
- Яркость каждой точки рассчитана как взвешенная сумма RGB:  
    `Y = 0.299·R + 0.587·G + 0.114·B`.
- Сохранена контрастность исходного изображения, но удалена цветовая насыщенность.
![[Pasted image 20251209113431.png]]
**Рис. 4 — Облако точек в серых тонах после Convert to Grey Scale** 

###### 2.4 `Edit → Colors → Invert`
- Применена инверсия: `Edit → Colors → Invert`.
- Для каждой точки:  
    `R' = 255 − R`, `G' = 255 − G`, `B' = 255 − B`.
- Цветовая схема изменилась на противоположную (комплементарную).
##### Шаг 3: Сохранение результатов
1. Изменённые облака сохранены в формате `.ply`
2. Подтверждено, что при повторной загрузке цветовая информация сохраняется.

---

### Ответы на вопросы
1. **RGB-цвета в облаке точек** — это трёхкомпонентные значения (Red, Green, Blue), присвоенные каждой точке и отражающие её визуальный цвет (например, из фотограмметрии или сканирования с камерой). Используются для:
    - Фотореалистичной визуализации
    - Выделения материалов, зон повреждений, аномалий
    - Поддержки интерпретации при анализе

2. **Форматы, поддерживающие цвет**:
    - `.ply` (ASCII / binary, с `property uchar red/green/blue`)
    - `.las` / `.laz` (стандарт LiDAR: поля `R`, `G`, `B` как 16-битные значения)
    - `.e57` (с цветовой информацией в блоке `color`)
    - `.pcd` (Point Cloud Library format)
    - `.xyzrgb`, `.txt` (если колонки RGB присутствуют)
    - `.bin` — только если структура файла включает RGB (часто — нет, требуется уточнение формата)

3. **Проверка наличия цвета**:
    - В панели _Properties_ → вкладка _Colors_: наличие строки `RGB` или `Colors: yes`
    - При наведении на точку — в строке состояния отображаются значения R/G/B
    - Через `Edit → Scalar fields → Show histogram` — если нет активного SF, но есть цвет → RGB отдельно от SF

4. **Set Color** — устанавливает одинаковый цвет для всех точек. Применяется:
    - При создании «чистого» фона
    - Для выделения сегментированного объекта
    - Перед наложением другой цветовой схемы (очистка от шумных RGB-данных)

5. **Height Ramp vs. Set Color**:
    - `Set Color` — одноцветное заполнение.
    - `Height Ramp` — _цветовая градация по скалярному полю_ (по умолчанию — по высоте Z), где мин./макс. значения сопоставляются с цветами шкалы (например, синий→красный). Позволяет визуализировать изменение параметра.

6. **Цветовая градация не по высоте?** — Да. Требуется:
    - Вычислить нужное скалярное поле (`Edit → Scalar fields → Compute…`):
        - плотность (`Density`), интенсивность (`Intensity`), кривизна (`Curvature`), расстояние до плоскости и др.
    - Сделать его активным (`Set SF as active`)
    - Применить `Edit → Colors → SF Ramp` (или `Height Ramp` — он тоже использует _активное_ SF, не только Z)

7. **Convert to Grey Scale** — преобразует каждый цвет в оттенок серого по формуле яркости (Y = 0.299R + 0.587G + 0.114B).  
    Полезно:
    - Для упрощения анализа яркостных паттернов
    - При подготовке данных к обработке в монохромных моделях ИИ
    - При сравнении с лидарными данными без цвета

8. **Invert** — инвертирует каждый цветовой канал (R → 255−R и т.д.).  
    Визуализация становится «негативной»: тёмные зоны — светлыми, тёплые — холодными.  
    Используется для улучшения контраста в трудных условиях освещения или при анализе теней.

9. **Ограничения при отсутствии RGB**:
    - Команды `Set Color`, `Convert to Grey Scale`, `Invert` _работают_, но:
        - `Convert to Grey Scale` и `Invert` — **не имеют эффекта**, если RGB изначально отсутствует (нет данных для преобразования).
        - `Height Ramp` и `SF Ramp` — **работают без RGB**, так как используют скалярные поля (SF), а не исходные цвета.

10. **Преимущества цветовой градации**:
    - Быстрая визуальная оценка распределения параметров (высота, плотность…)
    - Выявление аномалий (выбросы в SF — «пятна» контрастного цвета)
    - Упрощение интерпретации сложных 3D-структур без измерений

11. **Практическое применение Height Ramp**:
    - **Геодезия / ГИС**: визуализация рельефа, выделение террас, оползневых зон
    - **Архитектура**: проверка высоты этажей, выявление отклонений от проекта
    - **Промышленная инспекция**: оценка осадки фундаментов, деформаций резервуаров

12. **Ручные цвета vs. цвета по скалярному полю**:
    Ручные цвета (например, установленные через функцию _Set Color_) задаются произвольно и одинаковы для всех точек или выделенной группы — их основа — субъективный выбор пользователя. Такой подход статичен: после назначения цвет не меняется, даже если геометрия или другие параметры облака точек будут скорректированы. Информативная ценность таких цветов, как правило, невелика — они используются в основном для визуального выделения, упрощения композиции или группировки объектов.
	
	В отличие от них, цвета, назначенные по скалярному полю (например, через _SF Ramp_ или _Height Ramp_), напрямую зависят от числовых значений, привязанных к каждой точке (высота, плотность, кривизна и др.). При изменении скалярного поля (например, после пересчёта высот или фильтрации) цветовая визуализация обновляется автоматически. Такой метод обладает высокой аналитической ценностью: цвет становится инструментом интерпретации данных, позволяя быстро выявлять закономерности, аномалии и пространственные тенденции.
    
13. **Цвет для анализа объектов**:
    - **Рельеф**: Height Ramp → выделение склонов, водоразделов
    - **Фасады**: градация по отклонению от вертикали → выявление наклона/деформации
    - **Архитектура**: цвет по кривизне → обнаружение повреждений, трещин (высокая кривизна = контрастный цвет)

14. **Важность сохранения цвета при экспорте**:
    - Потеря цвета ≈ потеря контекста, текстуры, материалов
    - Без цвета — сложнее сегментация, регистрация, интерпретация
    - Другие специалисты (архитекторы, реставраторы) теряют визуальные ориентиры

15. **Передача плотности/интенсивности через цвет**:  
    - `Edit → Scalar fields → Compute → Density`
    - `Set SF as active`
    - `Edit → Colors → SF Ramp`  
        → Получаем облако, где насыщенность цвета отражает локальную плотность точек (полезно при анализе шумов, пропусков сканирования).

16. **Height Ramp без скалярного поля**:  
    — CloudCompare **автоматически создаёт SF «Height (Z)»**, если активное SF отсутствует.  
    — Если Z-координаты есть — всё работает.  
    — Если облако 2D (Z=0 везде) — градация будет одноцветной (разброс = 0)

17. **Визуальное сравнение двух облаков через цвет**:
    - Вычислить разность: `Tools → Distances → Compute` → получаем SF «Distances»
    - Применить `SF Ramp` к одному из облаков по этому полю  
        → Отклонения от другого облака окрашиваются по шкале (например: зелёный — совпадение, красный — отклонение > 5 мм)

18. **Редактирование части облака по цвету**:  
    1. `Tools → Segmentation →` (ручной выбор)
    2. `Edit → Scalar fields →  SF` (если SF связано с цветом)
    3. `Edit → Colors → Set Color` → применится только к выделенным точкам  
        — Также: `Tools → Batch processing` + маски по SF

19. **Связь скалярных полей и цвета**:  
    — Цвет — _визуальное отображение_ данных.  
    — SF — _числовые значения_, привязанные к точкам.  
    — CloudCompare позволяет **отображать SF через цвет** (`SF Ramp`, `Height Ramp`), но SF может существовать без цвета (и наоборот — RGB без SF).

20. **Активация SF для окраски по высоте**:
    - `Edit → Scalar fields → Compute → Height (Z)`
    - Выделить созданное поле → `Set SF as active` (правой кнопкой → _Set as active scalar field_)
    - `Edit → Colors → SF Ramp` или `Height Ramp`

21. **Отмена Height Ramp**:
    - `Edit → Undo` (Ctrl+Z) — если сразу после применения
    - Или: `Edit → Colors → Remove Color` → удалит все цвета (останется только геометрия)
    - Если нужен исходный RGB — перезагрузить файл или сохранить копию до изменений.

22. **Параметры Min / Max в цветовой шкале**:  
    — Определяют диапазон значений SF, который «растягивается» на всю цветовую палитру.  
    — Например: Min = 10 м, Max = 25 м → всё ниже 10 м — синее, выше 25 м — красное, между — плавный переход.  
    — Автоматически берутся min/max SF, но можно задать вручную для нормализации нескольких облаков.

23. **Сохранение цвета для повторного открытия**:  
    — Цвет сохраняется **только если**:
    - Экспорт в формат с поддержкой RGB (`.ply`, `.las`, `.e57`)
    - В настройках экспорта **включены опции**:  
     _Colors_  
     Scalar fields_ (если цвет привязан к SF, а не к RGB)  
    Для `.ply`: выбрать _binary (little endian)_ или _ASCII_, и убедиться, что галочка _Save colors_ активна.

### Выводы
1.  Цвет в облаках точек — не только «текстура», но и мощный **аналитический инструмент**.
    - CloudCompare позволяет гибко связывать числовые параметры (SF) с визуализацией через цвет, включая нестандартные поля (плотность, кривизна).
    - Важно различать _RGB-цвет_ (данные) и _цветовую карту_ (визуализация SF).
2. Полезные операции:
    - `Height Ramp` — для быстрой оценки вертикальной структуры
    - `SF Ramp` — универсальный инструмент под любую метрику
    - `Compute → Density` + `SF Ramp` — для анализа качества сканирования
